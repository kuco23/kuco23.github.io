<!DOCTYPE html>

<html>
<head>
  <title>Snake</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" charset="utf-8">
  <script src="https://code.jquery.com/jquery-latest.min.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Indie+Flower|Bungee+Hairline">
  <link rel="stylesheet" type="text/css" href="index.0f8dcdf5.css">
  <link rel="stylesheet" type="text/css" href="index.2153de1d.css">
  <link rel="stylesheet" type="text/css" href="index.9346ba2b.css">
  <link rel="stylesheet" type="text/css" href="index.fbb065e4.css">
  <link rel="stylesheet" type="text/css" href="index.c2343e74.css">

  <script>const PAGE_TRANSITION_SECONDS = 1000;
function toMenu() {
    $("#settings-panel-container").fadeOut(PAGE_TRANSITION_SECONDS);
    $("#game-over-div div:nth-child(1)").fadeOut(PAGE_TRANSITION_SECONDS);
    $("#game-over-div div:nth-child(2)").fadeOut(PAGE_TRANSITION_SECONDS);
    $("#game-over-div").fadeOut(PAGE_TRANSITION_SECONDS);
    $("#info-panel-container").fadeOut(PAGE_TRANSITION_SECONDS);
    setTimeout(function() {
        $("body").css("background-color", "rgb(211, 211, 211)");
        $("#menu-panel-container").fadeIn(PAGE_TRANSITION_SECONDS);
    }, PAGE_TRANSITION_SECONDS);
}
function toSettings() {
    $("#menu-panel-container").fadeOut(PAGE_TRANSITION_SECONDS, function() {
        $("#settings-panel-container").css("visibility", "visible").hide().fadeIn(PAGE_TRANSITION_SECONDS);
    });
    $("#player-color").val(document.game.config.graphics.playerColor);
    $("#snake-color").val(document.game.config.graphics.snakeColor);
    const slider = document.getElementById("snake-length");
    slider.value = document.game.config.snake.length;
    $("#snake-length-output").html(slider.value);
    slider.oninput = function() {
        $("#snake-length-output").html(this.value);
    };
}
function toInfo() {
    $("#menu-panel-container").fadeOut(PAGE_TRANSITION_SECONDS, function() {
        $("#info-panel-container").css("visibility", "visible").hide().fadeIn(PAGE_TRANSITION_SECONDS);
    });
}
function saveSettings() {
    document.game.config.snake.length = $("#snake-length").val();
    document.game.config.graphics.snakeColor = $("#snake-color").val();
    document.game.config.graphics.playerColor = $("#player-color").val();
    $("#saved-stamp").fadeIn(PAGE_TRANSITION_SECONDS, function() {
        $("#saved-stamp").fadeOut(PAGE_TRANSITION_SECONDS);
    });
}
function startGame() {
    $("#menu-panel-container").fadeOut(PAGE_TRANSITION_SECONDS, function() {
        $("#game-canvas").fadeIn(PAGE_TRANSITION_SECONDS).css("display", "block");
    });
    setTimeout(document.game.start.bind(document.game), PAGE_TRANSITION_SECONDS);
}
function restartGame() {
    $("#game-over-div div:nth-child(1)").fadeOut(PAGE_TRANSITION_SECONDS);
    $("#game-over-div div:nth-child(2)").fadeOut(PAGE_TRANSITION_SECONDS);
    $("#game-over-div").fadeOut(PAGE_TRANSITION_SECONDS, function() {
        $("#game-canvas").fadeIn(PAGE_TRANSITION_SECONDS).css("display", "block");
        $("body").css("background-color", "rgb(211, 211, 211)");
    });
    setTimeout(document.game.start.bind(document.game), PAGE_TRANSITION_SECONDS);
}
function onEndGame(gameWon) {
    gameWon ? $("#game-over-div div:nth-child(1)").css("display", "block") : $("#game-over-div div:nth-child(2)").css("display", "block");
    $("#game-canvas").fadeOut(PAGE_TRANSITION_SECONDS, function() {
        $("body").css("background-color", "black");
        $("#game-over-div").fadeIn(PAGE_TRANSITION_SECONDS);
    });
}
function _resizeCanvas() {
    $("#game-canvas").attr({
        width: window.innerWidth,
        height: window.innerHeight
    });
}

</script>

  <script type="module">class $cb44f3efbf515349$export$9b781de7bf37bf48 {
    constructor(x, y){
        this.x = x;
        this.y = y;
    }
    norm() {
        return Math.sqrt(this.x * this.x + this.y * this.y);
    }
    normed() {
        const norm = this.norm();
        return new $cb44f3efbf515349$export$9b781de7bf37bf48(this.x / norm, this.y / norm);
    }
    mul(alpha) {
        return new $cb44f3efbf515349$export$9b781de7bf37bf48(this.x * alpha, this.y * alpha);
    }
}
class $cb44f3efbf515349$export$baf26146a414f24a {
    constructor(x, y){
        this.x = x;
        this.y = y;
    }
    subtract(point) {
        return new $cb44f3efbf515349$export$9b781de7bf37bf48(this.x - point.x, this.y - point.y);
    }
}


class $e69004bddf41ab64$var$Snake {
    constructor(length, radius, speed){
        this.length = length;
        this.radius = radius;
        this.speed = speed;
        this.parts = [];
        for(let _ = 0; _ < length; _++){
            const randX = Math.floor(Math.random() * (window.innerWidth - 2 * radius));
            const randY = Math.floor(Math.random() * (window.innerHeight / 2));
            this.parts.push(new (0, $cb44f3efbf515349$export$baf26146a414f24a)(randX, randY));
        }
    }
    move(goal, radius) {
        let smallestDistancePartIndex = 0;
        let smallestDistance = Math.max(window.innerHeight, window.innerWidth);
        for(let i = 0; i < this.length; i++){
            const distance = goal.subtract(this.parts[i]).norm();
            if (distance < smallestDistance) {
                smallestDistancePartIndex = i;
                smallestDistance = distance;
            }
        }
        if (smallestDistance + this.speed < this.radius + radius) return false;
        const head = this.parts[smallestDistancePartIndex];
        const dir = goal.subtract(head).normed().mul(this.speed);
        head.x += dir.x;
        head.y += dir.y;
        let i = smallestDistancePartIndex;
        for(let _ = 0; _ < this.length - 1; _++){
            if (i == this.length) i = 0;
            const prev = this.parts[i];
            const curr = this.parts[i + 1 == this.length ? 0 : i + 1];
            const dist = prev.subtract(curr).norm();
            if (dist > 2 * this.radius + this.speed) {
                const dir = prev.subtract(curr).normed().mul(this.speed);
                curr.x += dir.x;
                curr.y += dir.y;
            } else {
                const dir = prev.subtract(curr).normed().mul(2 * this.radius);
                curr.x = prev.x - dir.x;
                curr.y = prev.y - dir.y;
            }
            i++;
        }
        return true;
    }
}
class $e69004bddf41ab64$var$Player {
    constructor(speed, radius, x, y){
        this.speed = speed;
        this.radius = radius;
        this.x = x;
        this.y = y;
    }
    move(direction) {
        if (direction[0]) {
            if (this.y >= this.speed + this.radius) this.y -= this.speed;
        }
        if (direction[1]) {
            if (this.x + this.speed + this.radius <= window.innerWidth) this.x += this.speed;
        }
        if (direction[2]) {
            if (this.y + this.speed + this.radius <= window.innerHeight) this.y += this.speed;
        }
        if (direction[3]) {
            if (this.x >= this.speed + this.radius) this.x -= this.speed;
        }
    }
}
class $e69004bddf41ab64$var$SnakeGameGraphics {
    constructor(config){
        this.config = config;
    }
    drawPoint(point, radius, color) {
        this.config.context.fillStyle = color;
        this.config.context.beginPath();
        this.config.context.arc(point.x, point.y, radius, 0, 2 * Math.PI);
        this.config.context.fill();
    }
    drawSnake(snake) {
        for(let i = 0; i < snake.length; i++)this.drawPoint(snake.parts[i], snake.radius, this.config.snakeColor);
    }
    drawPlayer(player) {
        this.drawPoint(new (0, $cb44f3efbf515349$export$baf26146a414f24a)(player.x, player.y), player.radius, this.config.playerColor);
    }
    clear() {
        this.config.context.clearRect(0, 0, this.config.canvas.width, this.config.canvas.height);
    }
    draw(snake, player) {
        this.drawSnake(snake);
        this.drawPlayer(player);
    }
    move(snake, player, direction) {
        this.clear();
        const moved = snake.move(new (0, $cb44f3efbf515349$export$baf26146a414f24a)(player.x, player.y), player.radius);
        if (!moved) return false;
        player.move(direction);
        this.draw(snake, player);
        return true;
    }
}
class $e69004bddf41ab64$export$e61a9c8f3f42be00 {
    constructor(config){
        this.config = config;
        this.direction = [
            false,
            false,
            false,
            false
        ];
        this.inProgress = false;
        this.graphics = new $e69004bddf41ab64$var$SnakeGameGraphics(config.graphics);
        this.snake = this.snakeFromConfig();
        this.player = this.playerFromConfig();
    }
    setDirectionFromKey(key, setTo) {
        switch(key){
            case "ArrowUp":
                this.direction[0] = setTo;
                break;
            case "ArrowRight":
                this.direction[1] = setTo;
                break;
            case "ArrowDown":
                this.direction[2] = setTo;
                break;
            case "ArrowLeft":
                this.direction[3] = setTo;
                break;
        }
    }
    snakeFromConfig() {
        return new $e69004bddf41ab64$var$Snake(this.config.snake.length, this.config.snake.radius, this.config.snake.speed);
    }
    playerFromConfig() {
        return new $e69004bddf41ab64$var$Player(this.config.player.speed, this.config.player.radius, this.config.player.x, this.config.player.y);
    }
    setEventListeners() {
        const self = this;
        window.addEventListener("keydown", function(e) {
            self.setDirectionFromKey(e.key, true);
        }, false);
        window.addEventListener("keyup", function(e) {
            self.setDirectionFromKey(e.key, false);
        }, false);
    }
    start() {
        this.inProgress = true;
        this.setEventListeners();
        this.snake = this.snakeFromConfig();
        this.player = this.playerFromConfig();
        this.graphics.draw(this.snake, this.player);
        this.interval = setInterval(this.update.bind(this), 1000 / this.config.framesPerSec);
    }
    update() {
        const moved = this.graphics.move(this.snake, this.player, this.direction);
        if (!moved) this.end(false);
    }
    end(gameWon) {
        this.inProgress = false;
        this.graphics.clear();
        clearInterval(this.interval);
        // @ts-ignore (callback is in the html file)
        onEndGame(gameWon);
    }
}


$(document).ready(function() {
    _resizeCanvas();
    const canvas = document.getElementById("game-canvas");
    const radius = 10;
    document.game = new (0, $e69004bddf41ab64$export$e61a9c8f3f42be00)({
        player: {
            speed: 2,
            radius: radius,
            x: canvas.width / 2,
            y: canvas.height - radius * 4
        },
        snake: {
            length: 20,
            radius: radius,
            speed: 1.2
        },
        graphics: {
            canvas: canvas,
            context: canvas.getContext("2d"),
            snakeColor: "black",
            playerColor: "black"
        },
        framesPerSec: 50
    });
});
$(window).on("resize", function() {
    if (document.game.inProgress) {
        alert("I didn't spend my time making this game just so you could resize the fucking window.");
        document.game.end();
    }
    _resizeCanvas();
});


</script>
</head>

<body>

  <div id="menu-panel-container" class="align-center">
    <div id="menu-panel" class="base-panel">
      <span id="title">SNAKE</span>
      <a onclick="startGame()">Start</a>
      <a style="cursor: not-allowed">Game&nbsp;Mode</a>
      <a onclick="toInfo()">Info</a>
      <a onclick="toSettings()">Settings</a>
    </div>
  </div>

  <div id="settings-panel-container" class="align-center">
    <div id="settings-panel" class="base-panel">
      <div id="saved-stamp">
        SAVED
      </div>
      <div>
        Snake&nbsp;length: <span id="snake-length-output"></span><br>
        <input type="range" id="snake-length" name="snake-length" min="1" max="40" value="20" class="slider"><br>
        Snake&nbsp;color:<br>
        <input type="text" id="snake-color" name="snake-color" class="snake-text-input"><br>
        Player&nbsp;color:<br>
        <input type="text" id="player-color" name="player-color" class="snake-text-input"><br>
        <div class="settings-buttons">
          <span onclick="saveSettings()">Save</span>
          <span onclick="toMenu()">Go&nbsp;Back</span>
        </div>
      </div>
    </div>
  </div>

  <div id="info-panel-container" class="align-center">
    <div id="info-panel" class="base-panel">
      <div id="info-content">
        There's no way to win, because you are a part of snake's body
        and it is its right to reclaim you. You can move freely though
        with the arrow keys.
      </div>
      <div class="to-menu-button">
        <span onclick="toMenu()">Go&nbsp;Back</span>
      </div>
    </div>
  </div>

  <canvas id="game-canvas">
  </canvas>

  <div id="game-over-div" class="game-over-panel">
    <div>
      <span>Y</span><span>O</span><span>U</span>&nbsp;
      <span>W</span><span>O</span><span>N</span>
    </div>
    <div>
      <span>Y</span><span>O</span><span>U</span>&nbsp;
      <span>L</span><span>O</span><span>S</span><span>T</span>
    </div>
    <div>
      Play&nbsp;Again:&nbsp;
      <span onclick="restartGame()">Y</span>/<span onclick="toMenu()">N</span>
    </div>
  </div>

</body>
</html>
