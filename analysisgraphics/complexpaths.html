<!DOCTYPE HTML>
<html>
<head>
  <title>Complex Analysys</title>
  <meta name='viewport' content='width=device-width, initial-scale=1.0' charset='utf-8' />
  <link rel='stylesheet' type='text/css' href='css/main.css' />
  <script src = '../jquery-3.3.1.min.js'></script>

  <style>
  </style>

  <script>

    function drawCurve() {
      document.kurvatura.startpoints = pointDistribution(
        document.kurvatura.source, 10, document.kurvatura.width,
        document.kurvatura.height, document.kurvatura.pic_margin);
      document.kurvatura.allpoints = redistribute(bezierCurve(
        document.kurvatura.startpoints, 100), document.kurvatura.point_margin, 1);
      document.kurvatura.delete();
      document.kurvatura.draw();
    }

    $(document).ready(function() {
      $.when(
        $.getScript('lib/random.js'),
        $.getScript('lib/vectors.js'),
        $.getScript('lib/curvealgorithms.js'),
        $.getScript('lib/curve.js')
      ).done(function() {

        $('div.uppermenu').outerHeight(0.1 * $(window).height(), true);
        const canvas = document.getElementById('this');
        canvas.width = $(window).width();
        canvas.height = $(window).height() * 0.9;
        const context = canvas.getContext('2d');

        let t0 = $('#this').width() / 2;
        let t1 = $('#this').height() / 2;
        document.kurvatura = new Curve(context, t0, t1, 100);
        drawCurve();

        canvas.addEventListener('click', function(event) {
          let offsety = $('#this').offset().top;
          document.kurvatura.drawanglesource(event.pageX, event.pageY - offsety);
          document.kurvatura.animateAngle();
        });

      });
    });

  </script>

  <body>

    <div class='uppermenu'>
      <div onclick='document.kurvatura.delete(); document.kurvatura.draw();'>
        refresh
      </div>
      <div onclick='drawCurve();'>
        drawnew
      </div>
    </div>

    <canvas id='this'>
    </canvas>

  </body>
</html>
