<!DOCTYPE HTML>
<html>
<head>
  <title>Complex Analysys</title>
  <meta name='viewport' content='width=device-width, initial-scale=1.0' charset='utf-8'>
  <script src = '../jquery-3.3.1.min.js'></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: powderblue;
    }
    #this {
      position: absolute;
      right: 50%;
      bottom: 50%;
      transform: translate(50%, 50%);
      background-color: white;
    }
  </style>

  <script>
    function random(a, b) {
      return a + Math.random() * (b - a);
    }
    function getnorm(vec) {
      return Math.pow(Math.pow(vec[0], 2) + Math.pow(vec[1], 2), 0.5);
    }
    function normed(vec, stretch=1) {
      let norm = getnorm(vec);
      return [vec[0] * stretch / norm, vec[1] * stretch / norm];
    }
    function fromatob(a, b) {
      return [b[0] - a[0], b[1] - a[1]];
    }
    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    $(document).ready(function() {
      const canvas = document.getElementById('this');
      canvas.width = $(window).width();
      canvas.height = $(window).height();
      const context = canvas.getContext('2d');

      function Curve(context, x0, y0, n_points,
      margin=1, linewidth=1, linecolor='black') {
        function drawLine(context, a, b, width, color) {
          context.lineWidth = width;
          context.strokeStyle = color;
          context.beginPath();
          context.moveTo(a[0], a[1]);
          context.lineTo(b[0], b[1]);
          context.stroke();
        }
        this.context = context;
        this.source = [x0, y0];
        this.margin = margin;
        this.linewidth = linewidth;
        this.linecolor = linecolor;
        this.points = [[x0, y0]];
        for (let i = 0; i < n_points; i++) {
          let ran_vector = normed([random(-1, 1), random(-1, 1)], this.margin);
          let p1 = this.points[i][0] + ran_vector[0];
          let p2 = this.points[i][1] + ran_vector[1];
          this.points.push([p1, p2]);
        }
        let i = this.points.length - 1;
        let vector = normed(fromatob(this.points[i], this.source), this.margin);
        while (getnorm(fromatob(this.points[i], this.source)) > this.margin) {
          let p1 = this.points[i][0] + vector[0];
          let p2 = this.points[i][1] + vector[1];
          this.points.push([p1, p2]);
          i++;
        }
        this.points.push(this.source);
        let n = this.points.length - 1;
        for (let i = 0; i < n; i++) {
          drawLine(this.context, this.points[i], this.points[i+1],
          this.linewidth, this.linecolor);
        }

        this.delete = function() {
          this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);
        }
      }

      let t0 = $(document).width() / 2;
      let t1 = $(document).height() / 2;
      console.log(t0, t1);

      async function animate() {
        while (true) {
          let cr = new Curve(context, t0, t1, 100, 20);
          await sleep(100);
          cr.delete();
        }
      }
      animate();

    });


  </script>

  <body>

    <canvas id='this'>
    </canvas>

  </body>
</html>
