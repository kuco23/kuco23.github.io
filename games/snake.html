<!DOCTYPE html>

<html>
<head>
  <meta name='viewport' content='width=device-width, initial-scale=1.0' charset='utf-8' />
  <title>Snake</title>

  <script src = '../jquery-3.3.1.min.js'></script>
  <link rel="stylesheet" type="text/css" href='https://fonts.googleapis.com/css?family=Bungee Hairline' />
  <link rel="stylesheet" type="text/css" href="snakeCss/snake.css" />

  <style>
  </style>

  <script>

  function gameRestart() {
    const gameOverDiv = $('#gameOverDiv');
    gameOverDiv.fadeOut(1000, function() {
      $('#firstCanvas').fadeIn(1000);
      $('body').css('background-color', 'rgb(211, 211, 211)');
    });
    setTimeout(document.game.start.bind(document.game), 1000);
  };

  function gameCallback(gameWon) {
    function formatText(text) {
      let formatted = '';
      for (let i = 0; i < text.length; i++) {
        if (text.charAt(i) != ' ') {
          formatted += '<span>' + text.charAt(i) + '</span>';
        } else {
          formatted += text.charAt(i);
        }
      }
      return formatted;
    }
    const gameStateDiv = $('#gameOverDiv div:first-child');
    if (gameWon) {
      gameStateDiv.html(formatText('You Won'));
      gameStateDiv.css({'text-shadow': '4px 4px 8px lime, 4px 4px 16px white', 'color': 'lime'});
    } else {
      gameStateDiv.html(formatText('You Lost'));
      gameStateDiv.css({'text-shadow': '4px 4px 8px FireBrick, 4px 4px 16px white', 'color': 'FireBrick'});
    }
    $('#firstCanvas').fadeOut(1000, function() {$('body').css('background-color', 'black');});
    setTimeout(function() {$('#gameOverDiv').fadeIn(1000);}, 2000);
  };

  $(document).ready(function() {
    $.when(
      $.getScript("snakeLib/collision.js"),
      $.getScript("snakeLib/snakeConstructors.js")
    ).done(function(){

      if (window.innerWidth >= 500 && window.innerHeight >= 500) {
        $('#firstCanvas').attr({'width': window.innerWidth * (3 / 4), 'height': window.innerHeight * (3 / 4)});
      } else {
        $('#firstCanvas').attr({'width': window.innerHeight.width, 'height': window.innerHeight.height});
      }

      const Canvas = document.getElementById('firstCanvas');
      const Context = Canvas.getContext('2d');

      const FRAMESPERSEC = 50;
      const PLAYERSPEED = 2; const PLAYERWIDTH = 20; const PLAYERHEIGHT = 10; const PLAYERCOLOR = 'black';
      const SHOTSPEED = 5; const SHOTWIDTH = 2; const SHOTHEIGHT = 12; const SHOTCOLOR = 'rgba(255, 0, 0, .5)';
      const SNAKESPEED = 1.2; const SNAKELIFE = 1; const SNAKELEN = 50; const SNAKEPARTSIZE = 10; const SNAKECOLOR = 'black';
      const SNAKESTARTX = Canvas.width / 2; const SNAKESTARTY = Canvas.height / 2;

      // game object creation
      document.game = new SnakeGame(Canvas, Context, FRAMESPERSEC,
      PLAYERSPEED, PLAYERWIDTH, PLAYERHEIGHT, PLAYERCOLOR,
      SHOTSPEED, SHOTWIDTH, SHOTHEIGHT, SHOTCOLOR,
      SNAKESPEED, SNAKELIFE, SNAKELEN, SNAKEPARTSIZE, SNAKECOLOR, SNAKESTARTX, SNAKESTARTY);
      document.game.start();

    });
  });

  </script>

</head>

<body>

  <canvas id='firstCanvas' height=60000 width=1000>
  </canvas>

  <div id='gameOverDiv'>
    <div>
    </div>
    <div>
      Play Again: <span onclick = 'gameRestart()'>Y</span>/<span>N</span>
    </div>
  </div>

</body>
</html>
